version: 1

services:
  - type: web
    name: taskflow-app
    env: node
    plan: free
    region: ohio
    buildCommand: |
      echo "ğŸ” Detectando estrutura do projeto..."
      ls -la
      
      if [ -f "package.json" ]; then
        echo "âœ… Estrutura: Arquivos na RAIZ"
        npm install
        npm run migrate
      elif [ -d "src" ] && [ -f "src/package.json" ]; then
        echo "âœ… Estrutura: Pasta SRC"
        cd src && npm install
        cd src && npm run migrate
      else
        echo "âŒ Estrutura nÃ£o reconhecida"
        echo "ğŸ“Š Procurando package.json..."
        find . -name "package.json" -maxdepth 2
        exit 1
      fi
      
    startCommand: |
      if [ -f "server.js" ]; then
        node server.js
      elif [ -f "src/server.js" ]; then
        cd src && node server.js
      else
        echo "âŒ server.js nÃ£o encontrado"
        exit 1
      fi
      
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: taskflow-db
          property: connectionString
    healthCheckPath: /health